<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta
      name="description"
      content="Time Together - ƒê·∫øm ng∆∞·ª£c th·ªùi gian b√™n nhau"
    />
    <meta name="theme-color" content="#d66291" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="shortcut icon" href="img/favicon.png" type="image/png" />
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="img/favicon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Time Together" />
    <title>Time Together</title>
  </head>
  <body>
  <script>
    (function() {
      const correctPassword = '310823';
      const authKey = 'timeTogetherAuth';
      const lockoutKey = 'timeTogetherLockout';
      const attemptsKey = 'timeTogetherAttempts';

      const hideContent = () => {
        document.body.innerHTML = '<div style="text-align: center; padding: 50px; color: white; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #111;"><h1>TRUY C·∫¨P B·ªä T·ª™ CH·ªêI</h1><p>M·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c ho·∫∑c b·∫°n ƒëang b·ªã kh√≥a. Vui l√≤ng t·∫£i l·∫°i trang v√† th·ª≠ l·∫°i sau.</p></div>';
      };
      
      if (localStorage.getItem(authKey) === 'true') {
        return;
      }

      const lockoutInfo = JSON.parse(sessionStorage.getItem(lockoutKey) || '{}');
      if (lockoutInfo.until && Date.now() < lockoutInfo.until) {
        const minutesLeft = Math.ceil((lockoutInfo.until - Date.now()) / 60000);
        alert(`B·∫°n ƒë√£ nh·∫≠p sai qu√° nhi·ªÅu l·∫ßn. Vui l√≤ng th·ª≠ l·∫°i sau ${minutesLeft} ph√∫t.`);
        hideContent();
        return;
      }

      const enteredPassword = prompt('‚ù§Ô∏è Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ v√†o nh√©:');

      if (enteredPassword === correctPassword) {
        localStorage.setItem(authKey, 'true');
        sessionStorage.removeItem(lockoutKey);
        sessionStorage.removeItem(attemptsKey);
      } else {
        let failedAttempts = parseInt(sessionStorage.getItem(attemptsKey) || '0') + 1;
        sessionStorage.setItem(attemptsKey, failedAttempts);

        let lockoutDuration = 0; // in minutes
        if (failedAttempts >= 10) {
          lockoutDuration = 30;
        } else if (failedAttempts >= 5) {
          lockoutDuration = 5;
        } else if (failedAttempts >= 3) {
          lockoutDuration = 1;
        }

        if (lockoutDuration > 0) {
          const lockoutUntil = Date.now() + lockoutDuration * 60 * 1000;
          sessionStorage.setItem(lockoutKey, JSON.stringify({ until: lockoutUntil }));
          alert(`M·∫≠t kh·∫©u sai. B·∫°n ƒë√£ b·ªã kh√≥a trong ${lockoutDuration} ph√∫t.`);
        } else {
          alert('M·∫≠t kh·∫©u sai. Vui l√≤ng th·ª≠ l·∫°i.');
        }
        
        hideContent();
      }
    })();
  </script>
    <div class="loading-screen">
      <div class="loading-container">
        <div class="loading-hearts">
          <div class="heart heart-1">üíñ</div>
          <div class="heart heart-2">üíñ</div>
          <div class="heart heart-3">üíñ</div>
        </div>
        <div class="loading-text">Time Together</div>
        <div class="loading-subtitle">ƒêang t·∫£i...</div>
      </div>
    </div>
    <!-- √Çm nh·∫°c n·ªÅn -->
    <audio id="bgMusic" src="music/music.mp3" preload="auto" loop></audio>
    <!-- Input ·∫©n ch·ªçn background -->
    <input
      type="file"
      id="file-input-bg"
      accept="image/*"
      style="display: none"
    />
    <div id="overlay"></div>
    
    
    <main id="info">
      <div class="profile one">
        <img src="img/male.jpg" class="avt" id="avt-male" alt="Tr·ªçng Nam" />
        <p class="t_name">Tr·ªçng Nam</p>
        <input
          type="file"
          id="file-input-male"
          accept="image/*"
          style="display: none"
        />
      </div>
      <canvas id="pinkboard" width="300" height="300"></canvas>
      <div class="profile two">
        <img src="img/female.jpg" class="avt" id="avt-female" alt="B√≠ch Ng·ªçc" />
        <p class="t_name">B√≠ch Ng·ªçc</p>
        <input
          type="file"
          id="file-input-female"
          accept="image/*"
          style="display: none"
        />
      </div>
    </main>
    <!-- Modal ch·ªçn avatar -->
    <div id="avatar-modal" class="avatar-modal hidden">
      <div class="avatar-modal-content">
        <h3 class="modal-title">‚ú® Ch·ªçn ·∫£nh ƒë·∫°i di·ªán ‚ú®</h3>
        <div id="modal-gallery" class="gallery"></div>
        <button id="upload-new-btn" class="modal-btn">T·∫£i ·∫£nh m·ªõi</button>
        <button id="close-modal-btn" class="modal-btn">ƒê√≥ng</button>
      </div>
    </div>
    <!-- Modal x√°c nh·∫≠n xo√° -->
    <div id="confirm-modal" class="avatar-modal hidden">
      <div class="avatar-modal-content">
        <p id="confirm-text" style="color: #fff; margin-bottom: 12px">
          B·∫°n mu·ªën xo√° ·∫£nh n√†y?
        </p>
        <button id="confirm-yes" class="modal-btn">Xo√°</button>
        <button id="confirm-no" class="modal-btn">Hu·ª∑</button>
      </div>
    </div>
    <div class="music-control">
      <i class="fas fa-play"></i>
    </div>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="js/main.js"></script>
  </body>
</html>
